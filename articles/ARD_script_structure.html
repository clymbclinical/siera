<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ARD program structure • siera</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ARD program structure">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">siera</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/apply-ARD.html">What do I do with my ARD?</a></li>
    <li><a class="dropdown-item" href="../articles/ARD_script_structure.html">ARD program structure</a></li>
    <li><a class="dropdown-item" href="../articles/Getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/using-cards.html">Making use of `cards` and `cardx`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/clymbclinical/siera/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>ARD program structure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/clymbclinical/siera/blob/v0.5.5/vignettes/ARD_script_structure.Rmd" class="external-link"><code>vignettes/ARD_script_structure.Rmd</code></a></small>
      <div class="d-none name"><code>ARD_script_structure.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://clymbclinical.github.io/siera/">siera</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="my-ard-program-has-been-auto-generated-what-can-i-expect">My ARD program has been auto-generated: What can I expect?<a class="anchor" aria-label="anchor" href="#my-ard-program-has-been-auto-generated-what-can-i-expect"></a>
</h2>
<p>Each auto-generated ARD program (one generated for each output)
follows a logical structure linked to the ARS model. Each script
contains code for all the analyses related to the output, and follows
the same code pattern for each analysis (except the first analysis,
which handles the “big N” calculation by convention). An analysis-level
ARD is generated for each analysis, and at the end of the program, all
these analysis-level ARDs are appended to create one output-level ARD.
Keep in mind that each of these code sections are auto-populated with
ARS metadata. This can be visualized as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Section 1: Program header</span></span>
<span></span>
<span><span class="co"># Section 2: Load libraries</span></span>
<span></span>
<span><span class="co"># Section 3: Load ADaM datasets</span></span>
<span></span>
<span><span class="co"># Section 4a (first Analysis): Code to calculate results as an ARD</span></span>
<span></span>
<span><span class="co"># Section 4b (subsequent Analyses): Code to calculate results as an ARD</span></span>
<span></span>
<span><span class="co"># Section 5: Append Analysis-level ARDs</span></span></code></pre></div>
<div class="section level3">
<h3 id="analysis-level-code-to-calculate-ards">Analysis-level code to calculate ARDs<a class="anchor" aria-label="anchor" href="#analysis-level-code-to-calculate-ards"></a>
</h3>
<p>Each analysis related to the output follows a logical structure based
on the ARS model to create an analysis-level ARD. This structure is as
follows:</p>
<div class="section level4">
<h4 id="step-1-apply-analysis-set-to-adams">Step 1: Apply “Analysis Set” to ADaM(s)<a class="anchor" aria-label="anchor" href="#step-1-apply-analysis-set-to-adams"></a>
</h4>
<p>This step applies the Analysis Set assigned to the output
(e.g. Safety Population) to the ADaM dataset(s). In the case where the
“big N” count is based on another dataset (like ADSL) than the main ADaM
(e.g. ADAE), two separate datasets are created for downstream use in
subsequent analyses. Example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ADSL</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ADAE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">overlapfin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">overlap</span>, <span class="st">"USUBJID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_pop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">ADSL</span>,</span>
<span>  <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">ADAE</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">overlapfin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>    all <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_poptot</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">ADSL</span>,</span>
<span>  <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note: this is only done once for the first Analysis, and assigned by
subsequent analyses, since the dataset(s) remain the same for the
remainder of the program’s analyses.</p>
</div>
<div class="section level4">
<h4 id="step-2-apply-data-subset">Step 2: Apply “Data Subset”<a class="anchor" aria-label="anchor" href="#step-2-apply-data-subset"></a>
</h4>
<p>Based on the resulting dataset from step 1, further data subsetting
is applied which is relevant to the current analysis (e.g. filtering for
serious, treatment-related Adverse Events). If no data subsetting is
required for the analysis, a simple assignment of the previous dataset
is done with no ‘filter’ statement. This step has a convention of
starting the dataframe name with “df2”, followed by the AnalysisId.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2_An07_03_SerTEAE_Summ_ByTrt</span> <span class="op">&lt;-</span> <span class="va">df_pop</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">TRTEMFL</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AESER</span> <span class="op">==</span> <span class="st">"Y"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="step-3-apply-method">Step 3: Apply “Method”<a class="anchor" aria-label="anchor" href="#step-3-apply-method"></a>
</h4>
<p>This step takes the subsetted dataset, and applies the required
AnalysisMethod (e.g. counting subjects by treatment and a group, like
RACE). As explained in the vignette for <a href="using-cards.html">using
<code>cards</code> and <code>cardx</code></a>, functions from these
packages are applied to handle the statistical operations for the
analysis. Typically, there would be some pre-work done on the dataset
before passing it to a <code>cards</code> or <code>cardx</code>
function. When the function is applied, the result is an analysis-level
ARD. At the end of this step, record-level metadata from the ARS model
is also merged to the ARD, to ensure the ability to trace each result
back to ARS metadata. See example below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># intermediate step: Prepare Denominator Dataset for `cards` function</span></span>
<span><span class="va">denom_dataset</span> <span class="op">&lt;-</span> <span class="va">df2_An01_05_SAF_Summ_ByTrt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">TRT01A</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># intermediate step: Prepare input dataset for `cards` function</span></span>
<span><span class="va">in_data</span> <span class="op">&lt;-</span> <span class="va">df2_An03_05_Race_Summ_ByTrt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">TRT01A</span>, <span class="va">RACE</span>, <span class="va">USUBJID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dummy <span class="op">=</span> <span class="st">"dummyvar"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pass calculate subjects counts and % (based on big N) grouped by treatment and race</span></span>
<span><span class="fu">cards</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/cards/latest-tag/reference/deprecated.html" class="external-link">ard_categorical</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">in_data</span>,</span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRT01A"</span>, <span class="st">"RACE"</span><span class="op">)</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"dummy"</span>,</span>
<span>  denominator <span class="op">=</span> <span class="va">denom_dataset</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># select relevant statistics as defined by the Method, and assign operation Ids</span></span>
<span><span class="va">df3_An03_05_Race_Summ_ByTrt</span> <span class="op">&lt;-</span> <span class="va">df3_An03_05_Race_Summ_ByTrt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stat_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"p"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>operationid <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">stat_name</span> <span class="op">==</span> <span class="st">"n"</span> <span class="op">~</span> <span class="st">"Mth01_1_n"</span>,</span>
<span>    <span class="va">stat_name</span> <span class="op">==</span> <span class="st">"p"</span> <span class="op">~</span> <span class="st">"Mth01_2_pct"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add ARS metadata IDs to the dataset to enable tracing each result back to ARS metadata</span></span>
<span><span class="va">df3_An03_05_Race_Summ_ByTrt</span> <span class="op">&lt;-</span> <span class="va">df3_An03_05_Race_Summ_ByTrt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    AnalysisId <span class="op">=</span> <span class="st">"An03_05_Race_Summ_ByTrt"</span>,</span>
<span>    MethodId <span class="op">=</span> <span class="st">"Mth01"</span>,</span>
<span>    OutputId <span class="op">=</span> <span class="st">"Out14-1-1"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="final-steps">Final steps<a class="anchor" aria-label="anchor" href="#final-steps"></a>
</h3>
<p>The above process repeats for each Analysis, although the code for
each step would of course vary (as defined in the specific ARS metadata
for each Analysis). Once each Analysis ARD has been created, these ARDs
are all appened to create output-level ARD. See example below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine analyses to create ARD ----</span></span>
<span><span class="va">ARD</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">df3_An01_05_SAF_Summ_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_01_Age_Summ_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_01_Age_Comp_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_02_AgeGrp_Summ_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_02_AgeGrp_Comp_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_03_Sex_Summ_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_03_Sex_Comp_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_04_Ethnic_Summ_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_04_Ethnic_Comp_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_05_Race_Summ_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_05_Race_Comp_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_06_Height_Summ_ByTrt</span>,</span>
<span>  <span class="va">df3_An03_06_Height_Comp_ByTrt</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Examples of such an ARD script has been shipped with this package.
Below are such examples, for</p>
<ul>
<li>Summary of Demographics: ARD_Out14-1-1.R</li>
<li>Overall Summary of Treatment-Emergent Adverse Events:
ARD_Out14-3-1-1.R</li>
</ul>
<p>Access these with the below functions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># see location of script:</span></span>
<span><span class="fu"><a href="../reference/ARD_script_example.html">ARD_script_example</a></span><span class="op">(</span><span class="st">"ARD_Out14-1-1.R"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ARD_script_example.html">ARD_script_example</a></span><span class="op">(</span><span class="st">"ARD_Out14-3-1-1.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># open script to inspect:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="fu"><a href="../reference/ARD_script_example.html">ARD_script_example</a></span><span class="op">(</span><span class="st">"ARD_Out14-1-1.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="fu"><a href="../reference/ARD_script_example.html">ARD_script_example</a></span><span class="op">(</span><span class="st">"ARD_Out14-3-1-1.R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run script locally:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="../reference/ARD_script_example.html">ARD_script_example</a></span><span class="op">(</span><span class="st">"ARD_Out14-1-1.R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="../reference/ARD_script_example.html">ARD_script_example</a></span><span class="op">(</span><span class="st">"ARD_Out14-3-1-1.R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This ARD can be used in various ways downstream. Read more about this
in the vignette on <a href="apply-ARD.html">utilising ARDs</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Malan Bosman, Clymb Clinical.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
